#!/bin/sh
# Pre-commit hook: format, lint, and test before every commit.
# Auto-configured by scripts/setup.sh (worktree-aware).
set -e

# 1. Auto-format staged Rust files and re-stage them.
echo "[pre-commit] Running cargo fmt..."
cargo fmt
# Re-stage any files that cargo fmt modified.
git diff --name-only --diff-filter=M | grep '\.rs$' | xargs -r git add

# 2. Lint — must pass with zero warnings.
echo "[pre-commit] Running cargo clippy..."
cargo clippy --all-targets -- -D warnings

# 3. Tests — all must pass.
echo "[pre-commit] Running cargo test..."
cargo test

echo "[pre-commit] All checks passed."
